<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysing TCGA, METABRIC and SCAN-B • ember</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysing TCGA, METABRIC and SCAN-B">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ember</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic-use.html">Basic usage</a></li>
    <li><a class="dropdown-item" href="../articles/run-docker-analysis.html">Analysing TCGA, METABRIC and SCAN-B</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chronchi/ember/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analysing TCGA, METABRIC and SCAN-B</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chronchi/ember/blob/HEAD/vignettes/run-docker-analysis.Rmd" class="external-link"><code>vignettes/run-docker-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>run-docker-analysis.Rmd</code></div>
    </div>

    
    
<p>In this vignette we provide a tutorial along with a docker image
containing the processed TCGA, SCAN-B and METABRIC datasets. This allows
us to have an easy and reproducible analysis.</p>
<div class="section level2">
<h2 id="what-is-docker">What is Docker<a class="anchor" aria-label="anchor" href="#what-is-docker"></a>
</h2>
<p>Docker is a tool that helps scientists, including those with little
programming experience, set up and share computational environments
easily and consistently. Think of it as a “container” for your work,
like a virtual lab bench that holds all the tools, software, and data
you need to run your analysis.</p>
</div>
<div class="section level2">
<h2 id="installing-docker">Installing Docker<a class="anchor" aria-label="anchor" href="#installing-docker"></a>
</h2>
<p>For <strong>Windows</strong> follow the instructions in this
page:</p>
<blockquote>
<p><a href="https://docs.docker.com/desktop/" class="external-link uri">https://docs.docker.com/desktop/</a></p>
</blockquote>
<p>For <strong>Linux</strong> follow the instructions in this page:</p>
<blockquote>
<p><a href="https://docs.docker.com/engine/install/" class="external-link uri">https://docs.docker.com/engine/install/</a></p>
</blockquote>
<p>For <strong>Mac</strong> follow the instructions in this page:</p>
<blockquote>
<p><a href="https://docs.docker.com/desktop/" class="external-link uri">https://docs.docker.com/desktop/</a></p>
</blockquote>
<p>For Windows and Mac you can use the docker desktop, whereas for Linux
you can use the engine in the terminal, as explained in the links
above.</p>
</div>
<div class="section level2">
<h2 id="download-ember-image">Download EMBER image<a class="anchor" aria-label="anchor" href="#download-ember-image"></a>
</h2>
<p>The EMBER image contains all the necessary data and initial R
packages to perform a basic analysis. In Docker, an image is like a
blueprint that defines everything needed to run a program, including the
operating system, software (e.g., R), and required packages.</p>
<p>Download the image from the link below. &gt; <a href="https://hub.docker.com/r/chronchi/ember_docker" class="external-link uri">https://hub.docker.com/r/chronchi/ember_docker</a></p>
<p>If using Docker Desktop, you can download the image directly from the
application using the search function and typing in
<code>chronchi/ember_docker</code>.</p>
</div>
<div class="section level2">
<h2 id="running-a-container">Running a container<a class="anchor" aria-label="anchor" href="#running-a-container"></a>
</h2>
<p>A container is a running instance of a Docker image, providing a
lightweight, isolated environment where your program or analysis
executes. Note here that whenever one closes a container, everything
saved and executed inside the container is lost. In order to avoid this
we need to set up a volume to save the results in a local folder in your
computer/server.</p>
<p>After downloading the image in the docker desktop, you can run a new
container by going to the Images tab and clicking in the play button
below Actions, associated with the respective image. Before you confirm,
we need to set up the volumes.</p>
</div>
<div class="section level2">
<h2 id="setting-up-volumes">Setting up volumes<a class="anchor" aria-label="anchor" href="#setting-up-volumes"></a>
</h2>
<p>The volumes are paths to folders in your local folders and correspond
to paths inside the container. Here we will set up three volumes, a
<code>scripts</code>, <code>results</code> and <code>docs</code> folder.
Everything saved within these folders will be available locally. In our
case we create a folder locally for the analysis and inside it the three
afore mentioned folders.</p>
<p>Then, for the container path you can simply add
<code>/home/rstudio/scripts</code>, <code>/home/rstudio/results</code>
and <code>/home/rstudio/docs</code> respectively in the container
paths.</p>
</div>
<div class="section level2">
<h2 id="ports">Ports<a class="anchor" aria-label="anchor" href="#ports"></a>
</h2>
<p>We set up the host port 8000. This will be the port used to run the
Rstudio server.</p>
</div>
<div class="section level2">
<h2 id="running-your-rstudio-session">Running your Rstudio session<a class="anchor" aria-label="anchor" href="#running-your-rstudio-session"></a>
</h2>
<p>Once everything is set, you can finally run your container and the
Rstudio can be opened at:</p>
<blockquote>
<p><a href="http://localhost:8000/" class="external-link uri">http://localhost:8000/</a></p>
</blockquote>
<p>If you used the port <code>8000</code>. If you used any other port
make sure to change the number <code>8000</code>. If you didn’t write
down anything in the port box, the default is <code>8787</code>.</p>
</div>
<div class="section level2">
<h2 id="logging-in">Logging in<a class="anchor" aria-label="anchor" href="#logging-in"></a>
</h2>
<p>The username is <code>rstudio</code> and the password can be found in
the Docker Desktop app in red within a sentence that says <em>The
password is set to random_password</em>, where <em>random_password</em>
corresponds to the randomly generated password.</p>
</div>
<div class="section level2">
<h2 id="analysing-the-data">Analysing the data<a class="anchor" aria-label="anchor" href="#analysing-the-data"></a>
</h2>
<p>From now on this is like using Rstudio locally, but with the data
already available within the folder <code>/home/rstudio/data</code> and
several packages installed, including EMBER. We just run an example
where we use TCGA, METABRIC and SCAN-B to visualize the invasive lobular
cancer samples in the 1000-genes EMBER embedding.</p>
<p>From here on you can create a file called analysis.qmd within the
scripts folder and we will run the code in that file.</p>
<div class="section level3">
<h3 id="load-the-data">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h3>
<p>There are multiple datasets available. Below we explain what these
datasets are precisely.</p>
<ul>
<li>
<code>metabric_embedded.rds</code>, <code>tcga_embedded.rds</code>
and <code>scanb_embedded.rds</code>: These are the datasets processed
for the EMBER embedding. Use them to visualize the PC3/PC4 biplots
colored by whatever metadata is available in each dataset.</li>
<li>
<code>metabric.rds</code>, <code>tcga.rds</code>,
<code>scanb.rds</code>: These are the datasets with batch effects
removed and the hallmark pathway scores calculated. Use them if you want
to further calculate other pathway scores using the function
<code><a href="../reference/get_scores_regressed.html">ember::get_scores_regressed</a></code>.</li>
<li>
<code>original_datasets.rds</code>: This is a single list containing
all the original datasets before doing any processing with EMBER.</li>
</ul>
<p>To load any of these files, use the <code>readRDS</code> function
available on base R. For example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tcga_embedded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"data/tcga_embedded.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-ilc-samples">Plotting ILC samples<a class="anchor" aria-label="anchor" href="#plotting-ilc-samples"></a>
</h3>
<p>In order to plot the ILC TCGA samples on top of all samples, colored
by their respective molecular subtype, we can use the following code.
The molecular subtype is available in the column
<code>molecular_subtype</code> and the histopathological status of the
tumors in the column <code>primary_diagnosis</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a function to color code consistently the different molecular</span></span>
<span><span class="co"># subtypes. We assume the dataframe has a column named pam50 with the </span></span>
<span><span class="co"># 6 different molecular subtypes shown below.</span></span>
<span><span class="va">get_colors_mol_sub</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># ggplot2 default palette scheme</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span>  <span class="va">hues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">375</span>, length <span class="op">=</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">colors_mol_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/hcl.html" class="external-link">hcl</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">hues</span>, l <span class="op">=</span> <span class="fl">65</span>, c <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span>    </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">colors_mol_sub</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"basal"</span>,</span>
<span>    <span class="st">"her2"</span>, </span>
<span>    <span class="st">"lumb"</span>, </span>
<span>    <span class="st">"luma"</span>, </span>
<span>    <span class="st">"normal"</span>,</span>
<span>    <span class="st">"claudin-low"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># we only use the colors available in the dataframe, otherwise</span></span>
<span>  <span class="co"># it shows all categories when it is not actually necessary</span></span>
<span>  <span class="va">selected_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">colors_mol_sub</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">pam50</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">colors_mol_sub</span><span class="op">[</span><span class="va">selected_colors</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Named vector that will be used to automatically convert the </span></span>
<span><span class="co"># names of the molecular subtypes in the legend.</span></span>
<span><span class="va">mol_subs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"basal"</span> <span class="op">=</span> <span class="st">"Basal-like"</span>, </span>
<span>  <span class="st">"her2"</span><span class="op">=</span> <span class="st">"HER2-enriched"</span>, </span>
<span>  <span class="st">"lumb"</span> <span class="op">=</span> <span class="st">"LumB"</span>, </span>
<span>  <span class="st">"luma"</span> <span class="op">=</span> <span class="st">"LumA"</span>, </span>
<span>  <span class="st">"normal"</span> <span class="op">=</span> <span class="st">"Normal-like"</span>,</span>
<span>  <span class="st">"claudin-low"</span> <span class="op">=</span> <span class="st">"Claudin-low"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the base plot containing all samples, from which the ILC samples</span></span>
<span><span class="co"># will be overlayed on.</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ember</span><span class="fu">::</span><span class="fu"><a href="../reference/get_base_plot.html">get_base_plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ILC samples on top of the embedded samples from SCAN-B, TCGA and</span></span>
<span><span class="co"># METABRIC</span></span>
<span><span class="va">final_plot</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="va">tcga_embedded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="va">colData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="va">data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">primary_diagnosis</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lobular carcinoma, NOS"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC3</span>, y <span class="op">=</span> <span class="va">PC4</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    shape <span class="op">=</span> <span class="fl">24</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">get_colors_mol_sub</span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">mol_subs</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">get_colors_mol_sub</span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">mol_subs</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Molecular\nsubtype"</span>, title <span class="op">=</span> <span class="st">"TCGA"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="va">final_plot</span></span></code></pre></div>
<p>Once the plot is adjusted to what you like, you can save it directly
using the <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggplot2::ggsave</a></code> function inside the
<code>results</code> folder. Alternatively, you can render your quarto
markdown document. That will generate all the plots automatically using
the figure width and height specified in each R chunk.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Carlos Ronchi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
